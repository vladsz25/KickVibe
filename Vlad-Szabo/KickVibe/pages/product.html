<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Product Details - KickVibe</title>
  <link rel="stylesheet" href="../css/main.css">
  <style>
    .breadcrumb {
      display: flex;
      align-items: center;
      gap: var(--spacing-md);
      margin-bottom: var(--spacing-2xl);
      font-size: 0.95rem;
    }

    .breadcrumb a {
      color: var(--primary);
      text-decoration: none;
      transition: var(--transition);
    }

    .breadcrumb a:hover {
      text-decoration: underline;
    }

    .breadcrumb span {
      color: var(--gray-400);
    }

    .product-gallery {
      display: grid;
      gap: var(--spacing-md);
    }

    .product-main-image {
      width: 100%;
      aspect-ratio: 1;
      background: linear-gradient(135deg, var(--gray-100) 0%, var(--gray-200) 100%);
      border-radius: var(--radius-2xl);
      overflow: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
      border: 1px solid var(--gray-200);
    }

    .product-main-image img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: transform 0.3s ease;
    }

    .product-main-image:hover img {
      transform: scale(1.05);
    }

    .size-selector {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(60px, 1fr));
      gap: var(--spacing-md);
      margin: var(--spacing-lg) 0;
    }

    .size-btn {
      padding: var(--spacing-md);
      border: 2px solid var(--gray-200);
      background-color: var(--white);
      border-radius: var(--radius-lg);
      cursor: pointer;
      transition: var(--transition);
      font-weight: 700;
      font-size: var(--font-size-base);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .size-btn:hover {
      border-color: var(--primary);
      background-color: rgba(255, 107, 53, 0.05);
    }

    .size-btn.active {
      background: linear-gradient(135deg, var(--primary), var(--primary-dark));
      color: var(--white);
      border-color: var(--primary);
      box-shadow: 0 4px 12px rgba(255, 107, 53, 0.3);
    }

    .product-specs {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: var(--spacing-md);
      margin: var(--spacing-xl) 0;
    }

    .spec-item {
      padding: var(--spacing-lg);
      background: linear-gradient(135deg, var(--gray-50), var(--white));
      border: 1px solid var(--gray-200);
      border-radius: var(--radius-lg);
    }

    .spec-label {
      font-size: var(--font-size-xs);
      color: var(--gray-500);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      font-weight: 700;
      margin-bottom: var(--spacing-xs);
    }

    .spec-value {
      font-weight: 700;
      color: var(--dark);
      font-size: var(--font-size-lg);
    }

    .price-section {
      background: linear-gradient(135deg, var(--gray-50), var(--white));
      border: 2px solid var(--gray-200);
      border-radius: var(--radius-2xl);
      padding: var(--spacing-2xl);
      margin-bottom: var(--spacing-lg);
    }

    .action-buttons {
      display: grid;
      grid-template-columns: 2fr 1fr;
      gap: var(--spacing-md);
    }

    @media (max-width: 768px) {
      .product-section {
        grid-template-columns: 1fr !important;
      }

      .size-selector {
        grid-template-columns: repeat(auto-fit, minmax(50px, 1fr));
      }

      .product-specs {
        grid-template-columns: 1fr;
      }

      .action-buttons {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <div id="notifications"></div>

  <!-- Header -->
  <header>
    <div class="container">
      <nav class="navbar">
        <a href="../index.html" class="logo">KickVibe</a>
        
        <ul class="nav-links" style="display: none; max-width: 100%;">
          <li><a href="../index.html">Home</a></li>
          <li><a href="./shop.html">Shop</a></li>
        </ul>

        <div class="nav-actions">
          <button class="nav-icon" id="darkModeToggle" title="Dark Mode">Dark</button>
          <button class="nav-icon" id="searchToggle" title="Search">Search</button>
          <button class="nav-icon" id="wishlistBtn" title="Wishlist">‚ù§Ô∏è</button>
          <button class="nav-icon" id="cartBtn" style="position: relative;" title="Cart">Cart<span class="cart-count" id="cartCount" style="display: none;">0</span></button>
          <button class="nav-icon" id="userBtn" title="Account">Account</button>
        </div>
      </nav>
    </div>
  </header>

  <!-- Product Details -->
  <div style="min-height: 80vh; padding: var(--spacing-2xl) var(--spacing-md);">
    <div class="container">
      <!-- Breadcrumb -->
      <div class="breadcrumb">
        <a href="../index.html">Home</a>
        <span>/</span>
        <a href="./shop.html">Shop</a>
        <span>/</span>
        <span id="breadcrumbProduct">Product</span>
      </div>

      <div id="productContent" style="display: grid; grid-template-columns: 1fr 1fr; gap: var(--spacing-3xl);" class="product-section">
        
        <!-- Product Images -->
        <div>
          <div class="product-gallery" id="productGallery">
            <!-- Populated by JavaScript -->
          </div>
        </div>

        <!-- Product Info -->
        <div>
          <div id="productInfo">
            <!-- Populated by JavaScript -->
          </div>
        </div>
      </div>

      <!-- Related Products -->
      <div style="margin-top: var(--spacing-3xl);">
        <div style="text-align: center; margin-bottom: var(--spacing-2xl);">
          <h2 style="font-size: clamp(1.5rem, 4vw, 2.5rem); margin-bottom: var(--spacing-md); font-weight: 800;">You Might Also Like</h2>
          <p style="color: var(--gray-500); font-size: 1rem;">Similar sneakers that match your style</p>
        </div>
        <div class="grid grid-4" id="relatedProducts">
          <!-- Populated by JavaScript -->
        </div>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <footer>
    <div class="container">
      <div class="footer-grid">
        <div class="footer-section">
          <h4>About KickVibe</h4>
          <p style="color: var(--gray-300); font-size: 0.9rem;">Premium sneakers and exclusive streetwear for sneaker enthusiasts worldwide.</p>
        </div>
        <div class="footer-section">
          <h4>Quick Links</h4>
          <ul>
            <li><a href="../index.html">Home</a></li>
            <li><a href="./shop.html">Shop</a></li>
            <li><a href="./contact.html">Contact</a></li>
          </ul>
        </div>
        <div class="footer-section">
          <h4>Customer Service</h4>
          <ul>
            <li><a href="./shop.html">Shipping Info</a></li>
            <li><a href="./shop.html">Returns</a></li>
            <li><a href="./shop.html">Size Guide</a></li>
          </ul>
        </div>
      </div>
      <div class="footer-bottom">
        <p>&copy; 2024 KickVibe. All rights reserved.</p>
      </div>
    </div>
  </footer>

  <script src="../js/state.js"></script>
  <script src="../js/auth.js"></script>
  <script src="../js/utils.js"></script>
  <script>
    // Dark mode
    if (stateManager.isDarkMode()) {
      document.body.classList.add('dark-mode');
    }

    document.getElementById('darkModeToggle').addEventListener('click', () => {
      stateManager.toggleDarkMode();
      document.body.classList.toggle('dark-mode');
    });

    // Navigation
    document.getElementById('cartBtn').addEventListener('click', () => {
      window.location.href = './cart.html';
    });

    document.getElementById('userBtn').addEventListener('click', () => {
      const user = stateManager.getUser();
      if (user) {
        window.location.href = './profile.html';
      } else {
        window.location.href = './login.html';
      }
    });

    document.getElementById('wishlistBtn').addEventListener('click', () => {
      window.location.href = './wishlist.html';
    });

    let selectedSize = null;

    /**
     * Render product details
     */
    function renderProduct() {
      const productId = parseInt(getUrlParam('id'));
      if (!productId) {
        window.location.href = './shop.html';
        return;
      }

      const product = stateManager.getProductById(productId);
      if (!product) {
        stateManager.showNotification('Product not found', 'error');
        window.location.href = './shop.html';
        return;
      }

      // Breadcrumb
      document.getElementById('breadcrumbProduct').textContent = product.name;

      // Gallery
      document.getElementById('productGallery').innerHTML = `
        <div class="product-main-image">
          <img src="${getProductImage(product)}" alt="${product.name}">
        </div>
      `;

      // Info
      document.getElementById('productInfo').innerHTML = `
        <div>
          <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: var(--spacing-md);">
            <div>
              <div class="product-category">${product.category}</div>
              <h1 style="margin: var(--spacing-md) 0; font-size: clamp(1.5rem, 4vw, 2.5rem); font-weight: 800; line-height: 1.2;">${product.name}</h1>
            </div>
            <button class="btn btn-ghost" id="wishlistBtn2" onclick="toggleWishlist(${product.id});" style="padding: var(--spacing-md); font-size: 1.0rem;">
              ${stateManager.isInWishlist(product.id) ? 'Remove' : 'Add to Wishlist'}
            </button>
          </div>
          
          <div style="display: flex; align-items: center; gap: var(--spacing-lg); margin-bottom: var(--spacing-lg);">
            <div style="font-size: 1.3rem;">${renderStars(product.rating)}</div>
            <span style="color: var(--gray-400); font-weight: 600;">(${product.reviews} reviews)</span>
          </div>

          <div class="price-section">
            <div style="margin-bottom: var(--spacing-lg);">
              <div style="font-size: 0.85rem; color: var(--gray-500); text-transform: uppercase; letter-spacing: 1px; font-weight: 700; margin-bottom: var(--spacing-xs);">Price</div>
              <div style="font-size: clamp(1.8rem, 5vw, 3rem); font-weight: 900; background: linear-gradient(135deg, var(--primary), var(--primary-dark)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">
                ${formatPrice(product.price)}
              </div>
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: var(--spacing-lg);">
              <div>
                <div class="spec-label">Stock Available</div>
                <div style="font-weight: 700; color: var(--dark); font-size: 1.1rem;">${product.stock} units</div>
              </div>
              <div>
                <div class="spec-label">Status</div>
                <div style="font-weight: 700; font-size: 1.1rem; ${product.stock > 0 ? 'color: var(--success);' : 'color: var(--danger);'}">
                  ${product.stock > 0 ? 'In Stock' : 'Out of Stock'}
                </div>
              </div>
            </div>
          </div>

          <p style="margin: var(--spacing-lg) 0; color: var(--gray-600); line-height: 1.8; font-size: 1rem;">${product.description}</p>

          <div style="margin: var(--spacing-xl) 0;">
            <label style="margin-bottom: var(--spacing-md); font-size: 0.95rem;">Select Size</label>
            <div class="size-selector" id="sizeSelector">
              ${product.sizes.map(size => `
                <button class="size-btn" onclick="selectSize('${size}', event)">
                  ${size}
                </button>
              `).join('')}
            </div>
            <p style="font-size: 0.85rem; color: var(--gray-400); margin-top: var(--spacing-md);">Not sure about your size? <a href="./shop.html" style="color: var(--primary); font-weight: 700;">View size guide</a></p>
          </div>

          <div class="product-specs">
            <div class="spec-item">
              <div class="spec-label">Weight</div>
              <div class="spec-value">${product.specs.weight}</div>
            </div>
            <div class="spec-item">
              <div class="spec-label">Drop</div>
              <div class="spec-value">${product.specs.drop}</div>
            </div>
            <div class="spec-item">
              <div class="spec-label">Cushioning</div>
              <div class="spec-value">${product.specs.cushioning}</div>
            </div>
            <div class="spec-item">
              <div class="spec-label">Type</div>
              <div class="spec-value">${product.category}</div>
            </div>
          </div>

          <div class="action-buttons" style="margin-top: var(--spacing-2xl);">
            <button class="btn btn-primary btn-large" onclick="addToCart(${product.id})" ${product.stock === 0 ? 'disabled' : ''} style="font-weight: 800;">
              ${product.stock > 0 ? 'Add to Cart' : 'Out of Stock'}
            </button>
            <button class="btn btn-outline btn-large" onclick="toggleWishlist(${product.id})" style="font-weight: 800;">
              ${stateManager.isInWishlist(product.id) ? 'Remove' : 'Add to Wishlist'}
            </button>
          </div>

          <div style="margin-top: var(--spacing-2xl); padding: var(--spacing-lg); background: rgba(16, 185, 129, 0.1); border: 1px solid var(--success); border-radius: var(--radius-lg);">
            <div style="display: flex; gap: var(--spacing-md); align-items: flex-start;">
              <div style="font-size: 1.1rem; flex-shrink: 0; font-weight:700; color:var(--success);">Note</div>
              <div>
                <div style="font-weight: 700; color: var(--success); margin-bottom: var(--spacing-xs);">100% Authentic Guaranteed</div>
                <p style="color: var(--gray-600); font-size: 0.9rem; margin: 0;">All products come with certificate of authenticity and 30-day money-back guarantee.</p>
              </div>
            </div>
          </div>
        </div>
      `;

      renderRelatedProducts(product);
    }

    /**
     * Select size
     */
    function selectSize(size, event) {
      selectedSize = size;
      document.querySelectorAll('.size-btn').forEach(btn => btn.classList.remove('active'));
      event.target.classList.add('active');
    }

    /**
     * Add to cart
     */
    function addToCart(productId) {
      if (!selectedSize) {
        stateManager.showNotification('Please select a size first', 'warning');
        return;
      }

      const product = stateManager.getProductById(productId);
      stateManager.addToCart(product, selectedSize);
      stateManager.showNotification('Added to cart!', 'success');
      updateCartCount();
    }

    /**
     * Toggle wishlist
     */
    function toggleWishlist(productId) {
      if (!isLoggedIn()) {
        stateManager.showNotification('Please login first', 'warning');
        window.location.href = './login.html';
        return;
      }

      const product = stateManager.getProductById(productId);
      if (stateManager.isInWishlist(productId)) {
        stateManager.removeFromWishlist(productId);
        stateManager.showNotification('Removed from wishlist', 'info');
      } else {
        stateManager.addToWishlist(product);
        stateManager.showNotification('Added to wishlist!', 'success');
      }

      renderProduct();
    }

    /**
     * Render related products
     */
    function renderRelatedProducts(product) {
      const related = getRandomItems(
        stateManager.getProducts().filter(p => p.id !== product.id && p.category === product.category),
        4
      );

      document.getElementById('relatedProducts').innerHTML = related.length > 0 ? related.map(p => `
        <div class="product-card" onclick="window.location.href='./product.html?id=${p.id}'">
          <div class="product-image">
            <img src="${getProductImage(p)}" alt="${p.name}">
            <div class="product-badge">New</div>
            <button class="product-wishlist-btn" onclick="event.stopPropagation(); toggleWishlist(${p.id});">
              ${stateManager.isInWishlist(p.id) ? '‚ù§Ô∏è' : 'ü§ç'}
            </button>
          </div>
          <div class="product-info">
            <div class="product-category">${p.category}</div>
            <div class="product-name">${p.name}</div>
            <div class="product-rating">
              ${renderStars(p.rating)}
              <span class="rating-text">(${p.reviews})</span>
            </div>
            <div class="product-price">
              <div class="product-price-current">${formatPrice(p.price)}</div>
            </div>
          </div>
        </div>
      `).join('') : '<p style="grid-column: 1/-1; text-align: center; color: var(--gray-500);">No related products found</p>';
    }

    /**
     * Update cart count
     */
    function updateCartCount() {
      const count = stateManager.getCart().length;
      const cartCount = document.getElementById('cartCount');
      if (count > 0) {
        cartCount.textContent = count;
        cartCount.style.display = 'flex';
      } else {
        cartCount.style.display = 'none';
      }
    }

    // Initialize
    window.addEventListener('load', () => {
      renderProduct();
      updateCartCount();
      stateManager.subscribe(() => updateCartCount());
    });
  </script>
</body>
</html>
